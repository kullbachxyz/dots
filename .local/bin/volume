#!/bin/bash

# Check if an argument is provided
if [ $# -ne 1 ]; then
  echo "Usage: $0 up|down"
  exit 1
fi

# Clear previous notifications using dunstctl
dunstctl close

# Perform the action based on the argument
if [ "$1" == "up" ]; then
  # Get the current volume as a floating point value (e.g., 1.00 for 100%)
  CURRENT_VOLUME=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | awk '{print $2}')

  # Check if the volume is less than 1.00 (100%)
  if (( $(echo "$CURRENT_VOLUME < 1.00" | bc -l) )); then
    # Increase volume by 10%
    wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%+ &>/dev/null
  else
    echo "Volume is already at 100%"
  fi
elif [ "$1" == "down" ]; then
  # Decrease volume by 10%
  wpctl set-volume @DEFAULT_AUDIO_SINK@ 10%- &>/dev/null
else
  echo "Invalid argument. Use 'up' or 'down'."
  exit 1
fi

# Get the current volume again after adjusting
CURRENT_VOLUME=$(wpctl get-volume @DEFAULT_AUDIO_SINK@ | awk '{print $2}')

# Convert the volume to a percentage and display it as a notification
CURRENT_VOLUME_PERCENT=$(echo "$CURRENT_VOLUME * 100" | bc -l)

# Display the current volume as a notification (without decimals)
# notify-send "Volume" "$(printf "%.0f" $CURRENT_VOLUME_PERCENT)%"
dunstify --hints=int:value:"$CURRENT_VOLUME_PERCENT" "Volume: $(printf "%.0f" "$CURRENT_VOLUME_PERCENT")%"
